---
import { getCollection } from 'astro:content';
import type { GetStaticPaths } from "astro";

import BlogLayout from '@layouts/BlogLayout.astro';
import { Formatter } from '@utils/formatter';
import { Image } from 'astro:assets';
import { getEntry } from 'astro:content';


export const getStaticPaths = ( async () => {
    
    const posts = await getCollection('blog');

    return posts.map((post) => {
        return { params: { slug: post.slug }, props: { post } }
    })
}) satisfies GetStaticPaths;

const { post } = Astro.props;
const { data } = post;


const { Content, headings } = await post.render();

const { data: author } = await  getEntry('author', data.author.id);

---

<BlogLayout title={ data.title }>
   
    <!-- author y fecha -->
    <div class="flex justify-between items-center mt-4">
        <div class="flex items-center">
            <Image class="w-8 h-8 rounded-full" src={ author.avatar } alt={ data.title }  width={100} height={100}/>
            <a href={`/blog/${post.data.author.id}`} class="ml-2 text-sm text-gray-500 hover:text-subtitle hover:underline">{ author.name}</a>
        </div>
        <span class="text-sm text-gray-500">{ Formatter.formatDate(data.date) }</span>
    </div>

    <Image transition:name={`${post.slug}-image`}  class="object-cover w-full h-56 rounded-lg my-5" src={ data.image } alt={ data.title } width={900} height={220} quality={'high'} />

    <!-- tabla de contenido -->
    <div class="mt-8">
        <h2 class=text-title/100">Tabla de contenido</h2>
        <ul class="mt-4 ml-5">
            {
                headings.map((heading, index) => (
                    <li class="text-gray-400">
                        <a class="text-inherit" href={ `#${ heading.slug }` }>{ index+1 }. { heading.text }</a>
                    </li>
                ))
            }
        </ul>
    </div>


    <Content />
</BlogLayout>